{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport React, { useState, useCallback, useRef } from 'react';\nimport addStyle from 'dom-lib/addStyle';\nimport addClass from 'dom-lib/addClass';\nimport removeClass from 'dom-lib/removeClass';\nimport omit from 'lodash/omit';\nimport merge from 'lodash/merge';\nimport { SCROLLBAR_WIDTH, SORT_TYPE } from '../constants';\nimport useControlled from './useControlled';\nimport getTableColumns from './getTableColumns';\nimport getTotalByColumns from './getTotalByColumns';\nimport useUpdateEffect from './useUpdateEffect'; //\n\n/**\n * Attach rendering-related attributes to all cells of the form and cache them.\n * @param props\n * @returns\n */\n\nvar useCellDescriptor = function useCellDescriptor(props) {\n  var children = props.children,\n      rtl = props.rtl,\n      mouseAreaRef = props.mouseAreaRef,\n      tableRef = props.tableRef,\n      minScrollX = props.minScrollX,\n      scrollX = props.scrollX,\n      tableWidth = props.tableWidth,\n      headerHeight = props.headerHeight,\n      showHeader = props.showHeader,\n      sortTypeProp = props.sortType,\n      defaultSortType = props.defaultSortType,\n      sortColumn = props.sortColumn,\n      rowHeight = props.rowHeight,\n      onSortColumn = props.onSortColumn,\n      prefix = props.prefix;\n\n  var _useControlled = useControlled(sortTypeProp, defaultSortType),\n      sortType = _useControlled[0],\n      setSortType = _useControlled[1];\n\n  var _useState = useState(),\n      cacheData = _useState[0],\n      setCacheData = _useState[1];\n\n  var clearCache = useCallback(function () {\n    setCacheData(null);\n  }, []);\n  var setColumnResizing = useCallback(function (resizing) {\n    if (resizing) {\n      addClass(tableRef.current, prefix('column-resizing'));\n    } else {\n      removeClass(tableRef.current, prefix('column-resizing'));\n    }\n  }, [prefix, tableRef]);\n  var columnWidths = useRef({});\n  useUpdateEffect(function () {\n    clearCache();\n  }, [children, sortColumn, sortType, tableWidth.current, scrollX.current, minScrollX.current]);\n  var handleColumnResizeEnd = useCallback(function (columnWidth, _cursorDelta, dataKey, index) {\n    columnWidths.current[dataKey + \"_\" + index + \"_width\"] = columnWidth;\n    setColumnResizing(false);\n    addStyle(mouseAreaRef.current, {\n      display: 'none'\n    });\n    clearCache();\n  }, [clearCache, mouseAreaRef, setColumnResizing]);\n  var handleColumnResizeMove = useCallback(function (width, left, fixed) {\n    var _addStyle;\n\n    var mouseAreaLeft = width + left;\n    var x = mouseAreaLeft;\n    var dir = 'left';\n\n    if (rtl) {\n      mouseAreaLeft += minScrollX.current + SCROLLBAR_WIDTH;\n      dir = 'right';\n    }\n\n    if (!fixed) {\n      x = mouseAreaLeft + (rtl ? -scrollX.current : scrollX.current);\n    }\n\n    addStyle(mouseAreaRef.current, (_addStyle = {\n      display: 'block'\n    }, _addStyle[dir] = x + \"px\", _addStyle));\n  }, [minScrollX, mouseAreaRef, rtl, scrollX]);\n  var handleColumnResizeStart = useCallback(function (width, left, fixed) {\n    setColumnResizing(true);\n    handleColumnResizeMove(width, left, fixed);\n  }, [handleColumnResizeMove, setColumnResizing]);\n  var handleSortColumn = useCallback(function (dataKey) {\n    var nextSortType = sortType;\n\n    if (sortColumn === dataKey) {\n      nextSortType = sortType === SORT_TYPE.ASC ? SORT_TYPE.DESC : SORT_TYPE.ASC;\n      setSortType(nextSortType);\n    }\n\n    onSortColumn === null || onSortColumn === void 0 ? void 0 : onSortColumn(dataKey, nextSortType);\n  }, [onSortColumn, setSortType, sortColumn, sortType]);\n\n  if (cacheData) {\n    return cacheData;\n  }\n\n  var hasCustomTreeCol = false;\n  var left = 0; // Cell left margin\n\n  var headerCells = []; // Table header cell\n\n  var bodyCells = []; // Table body cell\n\n  if (!children) {\n    var _cacheCell = {\n      columns: [],\n      headerCells: headerCells,\n      bodyCells: bodyCells,\n      hasCustomTreeCol: hasCustomTreeCol,\n      allColumnsWidth: left\n    };\n    setCacheData(_cacheCell);\n    return _cacheCell;\n  }\n\n  var columns = getTableColumns(children);\n  var count = columns.length;\n\n  var _getTotalByColumns = getTotalByColumns(columns),\n      totalFlexGrow = _getTotalByColumns.totalFlexGrow,\n      totalWidth = _getTotalByColumns.totalWidth;\n\n  React.Children.forEach(columns, function (column, index) {\n    if ( /*#__PURE__*/React.isValidElement(column)) {\n      var _columnWidths$current;\n\n      var columnChildren = column.props.children;\n      var _column$props = column.props,\n          width = _column$props.width,\n          resizable = _column$props.resizable,\n          flexGrow = _column$props.flexGrow,\n          minWidth = _column$props.minWidth,\n          onResize = _column$props.onResize,\n          treeCol = _column$props.treeCol;\n\n      if (treeCol) {\n        hasCustomTreeCol = true;\n      }\n\n      if (resizable && flexGrow) {\n        console.warn(\"Cannot set 'resizable' and 'flexGrow' together in <Column>, column index: \" + index);\n      }\n\n      if (columnChildren.length !== 2) {\n        throw new Error(\"Component <HeaderCell> and <Cell> is required, column index: \" + index + \" \");\n      }\n\n      var cellWidth = ((_columnWidths$current = columnWidths.current) === null || _columnWidths$current === void 0 ? void 0 : _columnWidths$current[columnChildren[1].props.dataKey + \"_\" + index + \"_width\"]) || width || 0;\n\n      if (tableWidth.current && flexGrow && totalFlexGrow) {\n        cellWidth = Math.max((tableWidth.current - totalWidth) / totalFlexGrow * flexGrow, minWidth || 60);\n      }\n\n      var cellProps = _extends({}, omit(column.props, ['children']), {\n        'aria-colindex': index + 1,\n        left: left,\n        headerHeight: headerHeight,\n        key: index,\n        width: cellWidth,\n        height: typeof rowHeight === 'function' ? rowHeight() : rowHeight,\n        firstColumn: index === 0,\n        lastColumn: index === count - 1\n      });\n\n      if (showHeader && headerHeight) {\n        var headerCellProps = {\n          // Resizable column\n          // `index` is used to define the serial number when dragging the column width\n          index: index,\n          dataKey: columnChildren[1].props.dataKey,\n          isHeaderCell: true,\n          minWidth: column.props.minWidth,\n          sortable: column.props.sortable,\n          onSortColumn: handleSortColumn,\n          sortType: sortType,\n          sortColumn: sortColumn,\n          flexGrow: flexGrow\n        };\n\n        if (resizable) {\n          merge(headerCellProps, {\n            onResize: onResize,\n            onColumnResizeEnd: handleColumnResizeEnd,\n            onColumnResizeStart: handleColumnResizeStart,\n            onColumnResizeMove: handleColumnResizeMove\n          });\n        }\n\n        headerCells.push( /*#__PURE__*/React.cloneElement(columnChildren[0], _extends({}, cellProps, headerCellProps)));\n      }\n\n      bodyCells.push( /*#__PURE__*/React.cloneElement(columnChildren[1], cellProps));\n      left += cellWidth;\n    }\n  });\n  var cacheCell = {\n    columns: columns,\n    headerCells: headerCells,\n    bodyCells: bodyCells,\n    allColumnsWidth: left,\n    hasCustomTreeCol: hasCustomTreeCol\n  };\n  setCacheData(cacheCell);\n  return cacheCell;\n};\n\nexport default useCellDescriptor;","map":{"version":3,"sources":["/Users/pango/Documents/Open/opener/frontend/node_modules/rsuite-table/es/utils/useCellDescriptor.js"],"names":["_extends","React","useState","useCallback","useRef","addStyle","addClass","removeClass","omit","merge","SCROLLBAR_WIDTH","SORT_TYPE","useControlled","getTableColumns","getTotalByColumns","useUpdateEffect","useCellDescriptor","props","children","rtl","mouseAreaRef","tableRef","minScrollX","scrollX","tableWidth","headerHeight","showHeader","sortTypeProp","sortType","defaultSortType","sortColumn","rowHeight","onSortColumn","prefix","_useControlled","setSortType","_useState","cacheData","setCacheData","clearCache","setColumnResizing","resizing","current","columnWidths","handleColumnResizeEnd","columnWidth","_cursorDelta","dataKey","index","display","handleColumnResizeMove","width","left","fixed","_addStyle","mouseAreaLeft","x","dir","handleColumnResizeStart","handleSortColumn","nextSortType","ASC","DESC","hasCustomTreeCol","headerCells","bodyCells","_cacheCell","columns","allColumnsWidth","count","length","_getTotalByColumns","totalFlexGrow","totalWidth","Children","forEach","column","isValidElement","_columnWidths$current","columnChildren","_column$props","resizable","flexGrow","minWidth","onResize","treeCol","console","warn","Error","cellWidth","Math","max","cellProps","key","height","firstColumn","lastColumn","headerCellProps","isHeaderCell","sortable","onColumnResizeEnd","onColumnResizeStart","onColumnResizeMove","push","cloneElement","cacheCell"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,oCAArB;AACA,OAAOC,KAAP,IAAgBC,QAAhB,EAA0BC,WAA1B,EAAuCC,MAAvC,QAAqD,OAArD;AACA,OAAOC,QAAP,MAAqB,kBAArB;AACA,OAAOC,QAAP,MAAqB,kBAArB;AACA,OAAOC,WAAP,MAAwB,qBAAxB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,KAAP,MAAkB,cAAlB;AACA,SAASC,eAAT,EAA0BC,SAA1B,QAA2C,cAA3C;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,eAAP,MAA4B,mBAA5B;AACA,OAAOC,iBAAP,MAA8B,qBAA9B;AACA,OAAOC,eAAP,MAA4B,mBAA5B,C,CAEA;;AAEA;AACA;AACA;AACA;AACA;;AACA,IAAIC,iBAAiB,GAAG,SAASA,iBAAT,CAA2BC,KAA3B,EAAkC;AACxD,MAAIC,QAAQ,GAAGD,KAAK,CAACC,QAArB;AAAA,MACIC,GAAG,GAAGF,KAAK,CAACE,GADhB;AAAA,MAEIC,YAAY,GAAGH,KAAK,CAACG,YAFzB;AAAA,MAGIC,QAAQ,GAAGJ,KAAK,CAACI,QAHrB;AAAA,MAIIC,UAAU,GAAGL,KAAK,CAACK,UAJvB;AAAA,MAKIC,OAAO,GAAGN,KAAK,CAACM,OALpB;AAAA,MAMIC,UAAU,GAAGP,KAAK,CAACO,UANvB;AAAA,MAOIC,YAAY,GAAGR,KAAK,CAACQ,YAPzB;AAAA,MAQIC,UAAU,GAAGT,KAAK,CAACS,UARvB;AAAA,MASIC,YAAY,GAAGV,KAAK,CAACW,QATzB;AAAA,MAUIC,eAAe,GAAGZ,KAAK,CAACY,eAV5B;AAAA,MAWIC,UAAU,GAAGb,KAAK,CAACa,UAXvB;AAAA,MAYIC,SAAS,GAAGd,KAAK,CAACc,SAZtB;AAAA,MAaIC,YAAY,GAAGf,KAAK,CAACe,YAbzB;AAAA,MAcIC,MAAM,GAAGhB,KAAK,CAACgB,MAdnB;;AAgBA,MAAIC,cAAc,GAAGtB,aAAa,CAACe,YAAD,EAAeE,eAAf,CAAlC;AAAA,MACID,QAAQ,GAAGM,cAAc,CAAC,CAAD,CAD7B;AAAA,MAEIC,WAAW,GAAGD,cAAc,CAAC,CAAD,CAFhC;;AAIA,MAAIE,SAAS,GAAGlC,QAAQ,EAAxB;AAAA,MACImC,SAAS,GAAGD,SAAS,CAAC,CAAD,CADzB;AAAA,MAEIE,YAAY,GAAGF,SAAS,CAAC,CAAD,CAF5B;;AAIA,MAAIG,UAAU,GAAGpC,WAAW,CAAC,YAAY;AACvCmC,IAAAA,YAAY,CAAC,IAAD,CAAZ;AACD,GAF2B,EAEzB,EAFyB,CAA5B;AAGA,MAAIE,iBAAiB,GAAGrC,WAAW,CAAC,UAAUsC,QAAV,EAAoB;AACtD,QAAIA,QAAJ,EAAc;AACZnC,MAAAA,QAAQ,CAACe,QAAQ,CAACqB,OAAV,EAAmBT,MAAM,CAAC,iBAAD,CAAzB,CAAR;AACD,KAFD,MAEO;AACL1B,MAAAA,WAAW,CAACc,QAAQ,CAACqB,OAAV,EAAmBT,MAAM,CAAC,iBAAD,CAAzB,CAAX;AACD;AACF,GANkC,EAMhC,CAACA,MAAD,EAASZ,QAAT,CANgC,CAAnC;AAOA,MAAIsB,YAAY,GAAGvC,MAAM,CAAC,EAAD,CAAzB;AACAW,EAAAA,eAAe,CAAC,YAAY;AAC1BwB,IAAAA,UAAU;AACX,GAFc,EAEZ,CAACrB,QAAD,EAAWY,UAAX,EAAuBF,QAAvB,EAAiCJ,UAAU,CAACkB,OAA5C,EAAqDnB,OAAO,CAACmB,OAA7D,EAAsEpB,UAAU,CAACoB,OAAjF,CAFY,CAAf;AAGA,MAAIE,qBAAqB,GAAGzC,WAAW,CAAC,UAAU0C,WAAV,EAAuBC,YAAvB,EAAqCC,OAArC,EAA8CC,KAA9C,EAAqD;AAC3FL,IAAAA,YAAY,CAACD,OAAb,CAAqBK,OAAO,GAAG,GAAV,GAAgBC,KAAhB,GAAwB,QAA7C,IAAyDH,WAAzD;AACAL,IAAAA,iBAAiB,CAAC,KAAD,CAAjB;AACAnC,IAAAA,QAAQ,CAACe,YAAY,CAACsB,OAAd,EAAuB;AAC7BO,MAAAA,OAAO,EAAE;AADoB,KAAvB,CAAR;AAGAV,IAAAA,UAAU;AACX,GAPsC,EAOpC,CAACA,UAAD,EAAanB,YAAb,EAA2BoB,iBAA3B,CAPoC,CAAvC;AAQA,MAAIU,sBAAsB,GAAG/C,WAAW,CAAC,UAAUgD,KAAV,EAAiBC,IAAjB,EAAuBC,KAAvB,EAA8B;AACrE,QAAIC,SAAJ;;AAEA,QAAIC,aAAa,GAAGJ,KAAK,GAAGC,IAA5B;AACA,QAAII,CAAC,GAAGD,aAAR;AACA,QAAIE,GAAG,GAAG,MAAV;;AAEA,QAAItC,GAAJ,EAAS;AACPoC,MAAAA,aAAa,IAAIjC,UAAU,CAACoB,OAAX,GAAqBhC,eAAtC;AACA+C,MAAAA,GAAG,GAAG,OAAN;AACD;;AAED,QAAI,CAACJ,KAAL,EAAY;AACVG,MAAAA,CAAC,GAAGD,aAAa,IAAIpC,GAAG,GAAG,CAACI,OAAO,CAACmB,OAAZ,GAAsBnB,OAAO,CAACmB,OAArC,CAAjB;AACD;;AAEDrC,IAAAA,QAAQ,CAACe,YAAY,CAACsB,OAAd,GAAwBY,SAAS,GAAG;AAC1CL,MAAAA,OAAO,EAAE;AADiC,KAAZ,EAE7BK,SAAS,CAACG,GAAD,CAAT,GAAiBD,CAAC,GAAG,IAFQ,EAEFF,SAFtB,EAAR;AAGD,GAnBuC,EAmBrC,CAAChC,UAAD,EAAaF,YAAb,EAA2BD,GAA3B,EAAgCI,OAAhC,CAnBqC,CAAxC;AAoBA,MAAImC,uBAAuB,GAAGvD,WAAW,CAAC,UAAUgD,KAAV,EAAiBC,IAAjB,EAAuBC,KAAvB,EAA8B;AACtEb,IAAAA,iBAAiB,CAAC,IAAD,CAAjB;AACAU,IAAAA,sBAAsB,CAACC,KAAD,EAAQC,IAAR,EAAcC,KAAd,CAAtB;AACD,GAHwC,EAGtC,CAACH,sBAAD,EAAyBV,iBAAzB,CAHsC,CAAzC;AAIA,MAAImB,gBAAgB,GAAGxD,WAAW,CAAC,UAAU4C,OAAV,EAAmB;AACpD,QAAIa,YAAY,GAAGhC,QAAnB;;AAEA,QAAIE,UAAU,KAAKiB,OAAnB,EAA4B;AAC1Ba,MAAAA,YAAY,GAAGhC,QAAQ,KAAKjB,SAAS,CAACkD,GAAvB,GAA6BlD,SAAS,CAACmD,IAAvC,GAA8CnD,SAAS,CAACkD,GAAvE;AACA1B,MAAAA,WAAW,CAACyB,YAAD,CAAX;AACD;;AAED5B,IAAAA,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAK,KAAK,CAA/C,GAAmD,KAAK,CAAxD,GAA4DA,YAAY,CAACe,OAAD,EAAUa,YAAV,CAAxE;AACD,GATiC,EAS/B,CAAC5B,YAAD,EAAeG,WAAf,EAA4BL,UAA5B,EAAwCF,QAAxC,CAT+B,CAAlC;;AAWA,MAAIS,SAAJ,EAAe;AACb,WAAOA,SAAP;AACD;;AAED,MAAI0B,gBAAgB,GAAG,KAAvB;AACA,MAAIX,IAAI,GAAG,CAAX,CAvFwD,CAuF1C;;AAEd,MAAIY,WAAW,GAAG,EAAlB,CAzFwD,CAyFlC;;AAEtB,MAAIC,SAAS,GAAG,EAAhB,CA3FwD,CA2FpC;;AAEpB,MAAI,CAAC/C,QAAL,EAAe;AACb,QAAIgD,UAAU,GAAG;AACfC,MAAAA,OAAO,EAAE,EADM;AAEfH,MAAAA,WAAW,EAAEA,WAFE;AAGfC,MAAAA,SAAS,EAAEA,SAHI;AAIfF,MAAAA,gBAAgB,EAAEA,gBAJH;AAKfK,MAAAA,eAAe,EAAEhB;AALF,KAAjB;AAOAd,IAAAA,YAAY,CAAC4B,UAAD,CAAZ;AACA,WAAOA,UAAP;AACD;;AAED,MAAIC,OAAO,GAAGtD,eAAe,CAACK,QAAD,CAA7B;AACA,MAAImD,KAAK,GAAGF,OAAO,CAACG,MAApB;;AAEA,MAAIC,kBAAkB,GAAGzD,iBAAiB,CAACqD,OAAD,CAA1C;AAAA,MACIK,aAAa,GAAGD,kBAAkB,CAACC,aADvC;AAAA,MAEIC,UAAU,GAAGF,kBAAkB,CAACE,UAFpC;;AAIAxE,EAAAA,KAAK,CAACyE,QAAN,CAAeC,OAAf,CAAuBR,OAAvB,EAAgC,UAAUS,MAAV,EAAkB5B,KAAlB,EAAyB;AACvD,SAAK,aAAa/C,KAAK,CAAC4E,cAAN,CAAqBD,MAArB,CAAlB,EAAgD;AAC9C,UAAIE,qBAAJ;;AAEA,UAAIC,cAAc,GAAGH,MAAM,CAAC3D,KAAP,CAAaC,QAAlC;AACA,UAAI8D,aAAa,GAAGJ,MAAM,CAAC3D,KAA3B;AAAA,UACIkC,KAAK,GAAG6B,aAAa,CAAC7B,KAD1B;AAAA,UAEI8B,SAAS,GAAGD,aAAa,CAACC,SAF9B;AAAA,UAGIC,QAAQ,GAAGF,aAAa,CAACE,QAH7B;AAAA,UAIIC,QAAQ,GAAGH,aAAa,CAACG,QAJ7B;AAAA,UAKIC,QAAQ,GAAGJ,aAAa,CAACI,QAL7B;AAAA,UAMIC,OAAO,GAAGL,aAAa,CAACK,OAN5B;;AAQA,UAAIA,OAAJ,EAAa;AACXtB,QAAAA,gBAAgB,GAAG,IAAnB;AACD;;AAED,UAAIkB,SAAS,IAAIC,QAAjB,EAA2B;AACzBI,QAAAA,OAAO,CAACC,IAAR,CAAa,+EAA+EvC,KAA5F;AACD;;AAED,UAAI+B,cAAc,CAACT,MAAf,KAA0B,CAA9B,EAAiC;AAC/B,cAAM,IAAIkB,KAAJ,CAAU,kEAAkExC,KAAlE,GAA0E,GAApF,CAAN;AACD;;AAED,UAAIyC,SAAS,GAAG,CAAC,CAACX,qBAAqB,GAAGnC,YAAY,CAACD,OAAtC,MAAmD,IAAnD,IAA2DoC,qBAAqB,KAAK,KAAK,CAA1F,GAA8F,KAAK,CAAnG,GAAuGA,qBAAqB,CAACC,cAAc,CAAC,CAAD,CAAd,CAAkB9D,KAAlB,CAAwB8B,OAAxB,GAAkC,GAAlC,GAAwCC,KAAxC,GAAgD,QAAjD,CAA7H,KAA4LG,KAA5L,IAAqM,CAArN;;AAEA,UAAI3B,UAAU,CAACkB,OAAX,IAAsBwC,QAAtB,IAAkCV,aAAtC,EAAqD;AACnDiB,QAAAA,SAAS,GAAGC,IAAI,CAACC,GAAL,CAAS,CAACnE,UAAU,CAACkB,OAAX,GAAqB+B,UAAtB,IAAoCD,aAApC,GAAoDU,QAA7D,EAAuEC,QAAQ,IAAI,EAAnF,CAAZ;AACD;;AAED,UAAIS,SAAS,GAAG5F,QAAQ,CAAC,EAAD,EAAKQ,IAAI,CAACoE,MAAM,CAAC3D,KAAR,EAAe,CAAC,UAAD,CAAf,CAAT,EAAuC;AAC7D,yBAAiB+B,KAAK,GAAG,CADoC;AAE7DI,QAAAA,IAAI,EAAEA,IAFuD;AAG7D3B,QAAAA,YAAY,EAAEA,YAH+C;AAI7DoE,QAAAA,GAAG,EAAE7C,KAJwD;AAK7DG,QAAAA,KAAK,EAAEsC,SALsD;AAM7DK,QAAAA,MAAM,EAAE,OAAO/D,SAAP,KAAqB,UAArB,GAAkCA,SAAS,EAA3C,GAAgDA,SANK;AAO7DgE,QAAAA,WAAW,EAAE/C,KAAK,KAAK,CAPsC;AAQ7DgD,QAAAA,UAAU,EAAEhD,KAAK,KAAKqB,KAAK,GAAG;AAR+B,OAAvC,CAAxB;;AAWA,UAAI3C,UAAU,IAAID,YAAlB,EAAgC;AAC9B,YAAIwE,eAAe,GAAG;AACpB;AACA;AACAjD,UAAAA,KAAK,EAAEA,KAHa;AAIpBD,UAAAA,OAAO,EAAEgC,cAAc,CAAC,CAAD,CAAd,CAAkB9D,KAAlB,CAAwB8B,OAJb;AAKpBmD,UAAAA,YAAY,EAAE,IALM;AAMpBf,UAAAA,QAAQ,EAAEP,MAAM,CAAC3D,KAAP,CAAakE,QANH;AAOpBgB,UAAAA,QAAQ,EAAEvB,MAAM,CAAC3D,KAAP,CAAakF,QAPH;AAQpBnE,UAAAA,YAAY,EAAE2B,gBARM;AASpB/B,UAAAA,QAAQ,EAAEA,QATU;AAUpBE,UAAAA,UAAU,EAAEA,UAVQ;AAWpBoD,UAAAA,QAAQ,EAAEA;AAXU,SAAtB;;AAcA,YAAID,SAAJ,EAAe;AACbxE,UAAAA,KAAK,CAACwF,eAAD,EAAkB;AACrBb,YAAAA,QAAQ,EAAEA,QADW;AAErBgB,YAAAA,iBAAiB,EAAExD,qBAFE;AAGrByD,YAAAA,mBAAmB,EAAE3C,uBAHA;AAIrB4C,YAAAA,kBAAkB,EAAEpD;AAJC,WAAlB,CAAL;AAMD;;AAEDc,QAAAA,WAAW,CAACuC,IAAZ,EAAkB,aAAatG,KAAK,CAACuG,YAAN,CAAmBzB,cAAc,CAAC,CAAD,CAAjC,EAAsC/E,QAAQ,CAAC,EAAD,EAAK4F,SAAL,EAAgBK,eAAhB,CAA9C,CAA/B;AACD;;AAEDhC,MAAAA,SAAS,CAACsC,IAAV,EAAgB,aAAatG,KAAK,CAACuG,YAAN,CAAmBzB,cAAc,CAAC,CAAD,CAAjC,EAAsCa,SAAtC,CAA7B;AACAxC,MAAAA,IAAI,IAAIqC,SAAR;AACD;AACF,GAxED;AAyEA,MAAIgB,SAAS,GAAG;AACdtC,IAAAA,OAAO,EAAEA,OADK;AAEdH,IAAAA,WAAW,EAAEA,WAFC;AAGdC,IAAAA,SAAS,EAAEA,SAHG;AAIdG,IAAAA,eAAe,EAAEhB,IAJH;AAKdW,IAAAA,gBAAgB,EAAEA;AALJ,GAAhB;AAOAzB,EAAAA,YAAY,CAACmE,SAAD,CAAZ;AACA,SAAOA,SAAP;AACD,CAlMD;;AAoMA,eAAezF,iBAAf","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport React, { useState, useCallback, useRef } from 'react';\nimport addStyle from 'dom-lib/addStyle';\nimport addClass from 'dom-lib/addClass';\nimport removeClass from 'dom-lib/removeClass';\nimport omit from 'lodash/omit';\nimport merge from 'lodash/merge';\nimport { SCROLLBAR_WIDTH, SORT_TYPE } from '../constants';\nimport useControlled from './useControlled';\nimport getTableColumns from './getTableColumns';\nimport getTotalByColumns from './getTotalByColumns';\nimport useUpdateEffect from './useUpdateEffect';\n\n//\n\n/**\n * Attach rendering-related attributes to all cells of the form and cache them.\n * @param props\n * @returns\n */\nvar useCellDescriptor = function useCellDescriptor(props) {\n  var children = props.children,\n      rtl = props.rtl,\n      mouseAreaRef = props.mouseAreaRef,\n      tableRef = props.tableRef,\n      minScrollX = props.minScrollX,\n      scrollX = props.scrollX,\n      tableWidth = props.tableWidth,\n      headerHeight = props.headerHeight,\n      showHeader = props.showHeader,\n      sortTypeProp = props.sortType,\n      defaultSortType = props.defaultSortType,\n      sortColumn = props.sortColumn,\n      rowHeight = props.rowHeight,\n      onSortColumn = props.onSortColumn,\n      prefix = props.prefix;\n\n  var _useControlled = useControlled(sortTypeProp, defaultSortType),\n      sortType = _useControlled[0],\n      setSortType = _useControlled[1];\n\n  var _useState = useState(),\n      cacheData = _useState[0],\n      setCacheData = _useState[1];\n\n  var clearCache = useCallback(function () {\n    setCacheData(null);\n  }, []);\n  var setColumnResizing = useCallback(function (resizing) {\n    if (resizing) {\n      addClass(tableRef.current, prefix('column-resizing'));\n    } else {\n      removeClass(tableRef.current, prefix('column-resizing'));\n    }\n  }, [prefix, tableRef]);\n  var columnWidths = useRef({});\n  useUpdateEffect(function () {\n    clearCache();\n  }, [children, sortColumn, sortType, tableWidth.current, scrollX.current, minScrollX.current]);\n  var handleColumnResizeEnd = useCallback(function (columnWidth, _cursorDelta, dataKey, index) {\n    columnWidths.current[dataKey + \"_\" + index + \"_width\"] = columnWidth;\n    setColumnResizing(false);\n    addStyle(mouseAreaRef.current, {\n      display: 'none'\n    });\n    clearCache();\n  }, [clearCache, mouseAreaRef, setColumnResizing]);\n  var handleColumnResizeMove = useCallback(function (width, left, fixed) {\n    var _addStyle;\n\n    var mouseAreaLeft = width + left;\n    var x = mouseAreaLeft;\n    var dir = 'left';\n\n    if (rtl) {\n      mouseAreaLeft += minScrollX.current + SCROLLBAR_WIDTH;\n      dir = 'right';\n    }\n\n    if (!fixed) {\n      x = mouseAreaLeft + (rtl ? -scrollX.current : scrollX.current);\n    }\n\n    addStyle(mouseAreaRef.current, (_addStyle = {\n      display: 'block'\n    }, _addStyle[dir] = x + \"px\", _addStyle));\n  }, [minScrollX, mouseAreaRef, rtl, scrollX]);\n  var handleColumnResizeStart = useCallback(function (width, left, fixed) {\n    setColumnResizing(true);\n    handleColumnResizeMove(width, left, fixed);\n  }, [handleColumnResizeMove, setColumnResizing]);\n  var handleSortColumn = useCallback(function (dataKey) {\n    var nextSortType = sortType;\n\n    if (sortColumn === dataKey) {\n      nextSortType = sortType === SORT_TYPE.ASC ? SORT_TYPE.DESC : SORT_TYPE.ASC;\n      setSortType(nextSortType);\n    }\n\n    onSortColumn === null || onSortColumn === void 0 ? void 0 : onSortColumn(dataKey, nextSortType);\n  }, [onSortColumn, setSortType, sortColumn, sortType]);\n\n  if (cacheData) {\n    return cacheData;\n  }\n\n  var hasCustomTreeCol = false;\n  var left = 0; // Cell left margin\n\n  var headerCells = []; // Table header cell\n\n  var bodyCells = []; // Table body cell\n\n  if (!children) {\n    var _cacheCell = {\n      columns: [],\n      headerCells: headerCells,\n      bodyCells: bodyCells,\n      hasCustomTreeCol: hasCustomTreeCol,\n      allColumnsWidth: left\n    };\n    setCacheData(_cacheCell);\n    return _cacheCell;\n  }\n\n  var columns = getTableColumns(children);\n  var count = columns.length;\n\n  var _getTotalByColumns = getTotalByColumns(columns),\n      totalFlexGrow = _getTotalByColumns.totalFlexGrow,\n      totalWidth = _getTotalByColumns.totalWidth;\n\n  React.Children.forEach(columns, function (column, index) {\n    if ( /*#__PURE__*/React.isValidElement(column)) {\n      var _columnWidths$current;\n\n      var columnChildren = column.props.children;\n      var _column$props = column.props,\n          width = _column$props.width,\n          resizable = _column$props.resizable,\n          flexGrow = _column$props.flexGrow,\n          minWidth = _column$props.minWidth,\n          onResize = _column$props.onResize,\n          treeCol = _column$props.treeCol;\n\n      if (treeCol) {\n        hasCustomTreeCol = true;\n      }\n\n      if (resizable && flexGrow) {\n        console.warn(\"Cannot set 'resizable' and 'flexGrow' together in <Column>, column index: \" + index);\n      }\n\n      if (columnChildren.length !== 2) {\n        throw new Error(\"Component <HeaderCell> and <Cell> is required, column index: \" + index + \" \");\n      }\n\n      var cellWidth = ((_columnWidths$current = columnWidths.current) === null || _columnWidths$current === void 0 ? void 0 : _columnWidths$current[columnChildren[1].props.dataKey + \"_\" + index + \"_width\"]) || width || 0;\n\n      if (tableWidth.current && flexGrow && totalFlexGrow) {\n        cellWidth = Math.max((tableWidth.current - totalWidth) / totalFlexGrow * flexGrow, minWidth || 60);\n      }\n\n      var cellProps = _extends({}, omit(column.props, ['children']), {\n        'aria-colindex': index + 1,\n        left: left,\n        headerHeight: headerHeight,\n        key: index,\n        width: cellWidth,\n        height: typeof rowHeight === 'function' ? rowHeight() : rowHeight,\n        firstColumn: index === 0,\n        lastColumn: index === count - 1\n      });\n\n      if (showHeader && headerHeight) {\n        var headerCellProps = {\n          // Resizable column\n          // `index` is used to define the serial number when dragging the column width\n          index: index,\n          dataKey: columnChildren[1].props.dataKey,\n          isHeaderCell: true,\n          minWidth: column.props.minWidth,\n          sortable: column.props.sortable,\n          onSortColumn: handleSortColumn,\n          sortType: sortType,\n          sortColumn: sortColumn,\n          flexGrow: flexGrow\n        };\n\n        if (resizable) {\n          merge(headerCellProps, {\n            onResize: onResize,\n            onColumnResizeEnd: handleColumnResizeEnd,\n            onColumnResizeStart: handleColumnResizeStart,\n            onColumnResizeMove: handleColumnResizeMove\n          });\n        }\n\n        headerCells.push( /*#__PURE__*/React.cloneElement(columnChildren[0], _extends({}, cellProps, headerCellProps)));\n      }\n\n      bodyCells.push( /*#__PURE__*/React.cloneElement(columnChildren[1], cellProps));\n      left += cellWidth;\n    }\n  });\n  var cacheCell = {\n    columns: columns,\n    headerCells: headerCells,\n    bodyCells: bodyCells,\n    allColumnsWidth: left,\n    hasCustomTreeCol: hasCustomTreeCol\n  };\n  setCacheData(cacheCell);\n  return cacheCell;\n};\n\nexport default useCellDescriptor;"]},"metadata":{},"sourceType":"module"}